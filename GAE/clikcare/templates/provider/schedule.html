{% extends "/layout/provider_nav.html" %}

{% set active_page = "schedule" %}

{% block subhead %}{{ _('Schedule') }}{% endblock %}
{% block lead %}{{ _('Organize your time.') }}{% endblock %}

{% block content %}


<div class="row">
	<div class="span12">
		
		<!-- <a href="#" id="b14" class="btn btn-mini"> <i class="icon-ban-circle"></i> </a> -->
		<!--<button class="btn btn-mini" onclick="changeClass()" >My Button</button> -->
		
		<table class="table table-striped table-condensed centered">
			<thead>
				<th></th>
				{% for day in days %}
				<th style="min-width: 55px; text-align: center">
					{{day[1]}}
				<!--
				<div class="btn-group" data-toggle="buttons-radio">
					<a href="#" class="btn btn-mini" rel="tooltip" title="{{ _('Busy All Day') }}"> <i class="icon-ban-circle"></i> </a>
					<a href="#" class="btn btn-mini" rel="tooltip" title="{{ _('Free All Day') }}"> <i class="icon-ok-circle"></i> </a>
				</div>
				-->
				</th>
				{% endfor %}
			</thead>
			
			<!-- timeslots are (name, starttime, endtime) -->
			{% for ts in timeslots %}
			<tr>
				<td rowspan="1"> 
					{{ts[0]}} <br>
					<small>{{ts[1]|format_hour}}-{{ts[2]|format_hour}}</small>
				</td>
				
				{% for day in days %}
				<td id="tt" style="text-align: center;">
					{% set button_id = day[0] ~ '-' ~ ts[1] ~ '-' ~ ts[2] %}
					{% if button_id in availableIds %}
						<a id="{{button_id}}" href="#" class="btn btn-mini btn-success" rel="tooltip" title="{{ _('Free') }}" style="width: 70%">
							<div style="width: 100%">
								<strong>{{day[1]}} <br> 
								{{ts[0]}}</strong> <br>
								<br>
								<i class="icon-ok-circle"></i> <br>
								<!--{{ _('Busy') }}<br> -->
								<br>
								<small>{{ts[1]|format_hour}}-{{ts[2]|format_hour}}</small><br>
								<!-- <code>{{button_id}}</code> -->
							</div> 
						</a>
					{% else %}
						<a id="{{button_id}}" href="#" class="btn btn-mini" rel="tooltip" title="{{ _('Busy') }}" style="width: 70%">
							<div style="width: 100%">
								<strong>{{day[1]}} <br> 
								{{ts[0]}}</strong> <br>
								<br>
								<i class="icon-ban-circle"></i> <br>
								<!--{{ _('Busy') }}<br> -->
								<br>
								<small>{{ts[1]|format_hour}}-{{ts[2]|format_hour}}</small><br>
								<!-- <code>{{button_id}}</code> -->
							</div> 
						</a>
					{% endif %}
					<!-- <a href="#" class="btn btn-mini btn-warning" rel="tooltip" title="{{ _('Free') }}"> <i class="icon-ok-circle"></i> </a> -->
				</td>
				{% endfor %}
			</tr>
			<tr> <td colspan="8"> <br> </td></tr>
			{% endfor %}
		</table>
	</div>
	
</div>

<script src="/assets/js/jquery.js"></script>

<script>
    $("#tt a").click(function () {
    	//alert("I am an alert box! " + $("#b14").attr("Class")); 
     	$(this).toggleClass("btn-success");
     	// TODO change icon inside the <a>
     	var $icon = $(this).find('div i');
     	var $new_tooltip = ''
     	
     	if ($(this).hasClass('btn-success')) {
     		op = 'add'
     		$icon.addClass('icon-ok-circle')
     		$icon.removeClass('icon-ban-circle')
			$new_tooltip = '{{ _("Free") }}'
     	}
     	else {
     		op = 'remove'
     		$icon.addClass('icon-ban-circle')
     		$icon.removeClass('icon-ok-circle')
     		//$(this).attr('title', 'Not Free')
     		$new_tooltip = '{{ _("Busy") }}'
     	}
     	// Weird workaround for tooltip change	
     	$(this).attr('data-original-title', $new_tooltip).tooltip('fixTitle'); 	
     	$(this).tooltip('toggle') 
     	$(this).tooltip('toggle')
     	
     	post_data = {
     		provider_key: "{{p.key()}}",
     		day_time: $(this).attr("id"),
     		operation: op
     	}
     	// post a save for the clicked schedule
     	$.post('/provider/schedule', post_data)
    });
</script>

{% endblock %}