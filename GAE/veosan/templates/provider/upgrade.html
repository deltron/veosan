{% extends "/layout/provider_nav.html" %}

{% set active_page = "upgrade" %}

{% block subhead %}{{ _('Upgrade') }}{% endblock %}
{% block lead %}{{ _('Access new features by upgrading your account.') }}{% endblock %}

{% block content %}
<style>
	.table tbody tr:hover td, .table tbody tr:hover th {
		background-color: transparent;
	}
</style>

<div class="row">
	<div class="span12">
		<table class="table table-bordered" style="width: 85%; margin: 0px auto">
			<thead>
				<th width="21%"></th>
				<th width="27%"><h2>Profile</h2><span style="font-size: smaller">Free</span></th>
				<th width="27%" style="background:#dddddd"><h2>Presence</h2><span style="font-size: smaller">9.99 / month</span></th>
			</thead>
			<tr>
				<td><h2>Get Online</h2></td>
				<td>
				<ul>
					<li>
						Complete profile and contact information
					</li>
					<li>
						Optimized for search engine and social networks
					</li>
				</ul></td>
				<td style="background:#eeeeee">
				<ul>
					<li>
						Complete profile and contact information
					</li>
					<li>
						Optimized for search engine and social networks
					</li>
					<li>
						<span style="font-weight:bold">See statistics about who is searching for your expertise</span>
					</li>
				</ul></td>
			</tr>
			<tr>
				<td><h2>Get Patients</h2></td>
				<td>
				<ul>
					<li>
						Use your online profile to promote your practice
					</li>
					<li>
						Build your referral network by connecting with other professionals
					</li>
				</ul></td>
				<td style="background:#eeeeee">
				<ul>
					<li>
						Use your online profile to promote your practice
					</li>
					<li>
						Build your referral network by connecting with other professionals
					</li>
					<li>
						<span style="font-weight:bold">Display your schedule and let patients book appointments online</span>
					</li>
				</ul></td>
			</tr>
		</table>
		<br>
		<table style="width: 85%; margin: 0px auto" border="0">
			<tr>
				<td width="20%"></td>
				<td width="27%"></td>
				<td width="27%" style="text-align: center;"><a data-toggle="modal" href="#upgrade_modal" class="btn btn-success btn-large">Upgrade</a></td>
			</tr>
		</table>

	</div>
</div>

<div class="modal hide" id="upgrade_modal" style="display: none;">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">Ã—</a>

		<h3>Upgrade</h3>
	</div>
	<form action="" method="post" id="payment-form">
		<div class="modal-body">
			<span class="payment-errors"></span>
			<div class="form-row">
				<label>Card Number</label>
				<input type="text" size="20" autocomplete="off" class="card-number"/>
			</div>
			<div class="form-row">
				<label>CVC</label>
				<input type="text" size="4" autocomplete="off" class="card-cvc"/>
			</div>
			<div class="form-row">
				<label>Expiration (MM/YYYY)</label>
				<input type="text" size="2" class="card-expiry-month"/>
				<span> / </span>
				<input type="text" size="4" class="card-expiry-year"/>
			</div>

		</div>

		<div class="modal-footer">
			<button type="submit" class="btn btn-success">
				Submit Payment
			</button>
		</div>
	</form>
</div>

{% endblock %}

{% block extra_javascript %}

<script type="text/javascript" src="https://js.stripe.com/v1/"></script>
<script type="text/javascript">
Stripe.setPublishableKey('pk_0CGm7P3z0UJVLSfX3Pj5z7NKuzUjj');

$(document).ready(function() {
  $("#payment-form").submit(function(event) {
    // disable the submit button to prevent repeated clicks
    $('.submit-button').attr("disabled", "disabled");

    Stripe.createToken({
        number: $('.card-number').val(),
        cvc: $('.card-cvc').val(),
        exp_month: $('.card-expiry-month').val(),
        exp_year: $('.card-expiry-year').val()
    }, stripeResponseHandler);
        
    // prevent the form from submitting with the default action
    return false;
  });
});

function stripeResponseHandler(status, response) {
    if (response.error) {
        // show the errors on the form
        $(".payment-errors").text(response.error.message);
        $(".submit-button").removeAttr("disabled");
    } else {
        var form$ = $("#payment-form");
        // token contains id, last4, and card type
        var token = response['id'];
        // insert the token into the form so it gets submitted to the server
        form$.append("<input type='hidden' name='stripeToken' value='" + token + "'/>");
        // and submit
        form$.get(0).submit();
    }
}
</script>

{% endblock %}
